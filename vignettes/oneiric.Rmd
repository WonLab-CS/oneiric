---
title: "Simulating Tissues with Oneiric"
author: "Patrick Martin"
output:
    pdf_document: null
    keep_tex: yes
    number_sections: no
    html_document:
        toc: true
package: '`oneiric'''
vignette: |
    %\VignetteIndexEntry{Oneiric User's Guide}
    %\VignetteEncoding{UTF-8}
    %\VignetteEngine{knitr::rmarkdown}
---

#  Introduction

```{r setup, eval = TRUE, echo = TRUE}
library(oneiric)
library(scater)
library(ggplot2)
library(RColorBrewer)
set.seed(288)
```

# Data

## Chaos Parameters
```{r chaos_param, eval = TRUE, echo  = TRUE}

data(oneiric)
str(map_params)
```

## Simulated Territories
```{r sim_ter, eval = TRUE, echo = TRUE}
sim_ter <- paste0(system.file(package = "oneiric"), "/inst/extdata/")
dir(sim_ter)
```

## Preparing output directory
```{r out_dir, eval = TRUE, echo = TRUE}
if (!dir.exists("output/")) {
    output <- dir.create("output/")
}
output <- "output/"
```

# Creating New Data sets

## Simulate New Territories 

```{r spatial_sim, eval = TRUE, echo = TRUE}
circle <- simulate_spatial(n_cells = 6000,
    n_territories = 5,
    n_samples = 12,
    pattern = "circle",
    max_expanse = 0.3)

rod <- simulate_spatial(n_cells = 6000,
    n_territories = 5,
    n_samples = 12,
    pattern = "rod",
    max_width = 0.1,
    max_length = 0.5)

chaos_map <- simulate_spatial(n_cells = 6000,
    n_samples = 12,
    pattern = "chaos",
    max_expanse = 0.02)

```

### Circular Territories
```{r view_circles, eval = TRUE, echo = TRUE, fig.width = 9, fig.height=9, fig.cap = "Circular Territories"}
circles <- do.call("rbind", circle)
circles$Territory <- as.factor(circles$Territory)
g <- ggplot(circles, aes(x = x, y = y, col = Territory)) +
    geom_point(size = 0.5) +
    theme_bw() +
    scale_color_brewer(palette = "Spectral") +
    facet_wrap(~sample) +
    guides(colour = guide_legend(
        override.aes = list(size =  5)))
print(g)
```

### Rod Territories
```{r view_rod, eval = TRUE, echo = TRUE, fig.width = 9, fig.height=9, fig.cap = "Rod Territories"}
rods <- do.call("rbind", rod)
rods$Territory <- as.factor(rods$Territory)
g <- ggplot(rods, aes(x = x, y = y, col = Territory)) +
    geom_point(size = 0.5) +
    theme_bw() +
    scale_color_brewer(palette = "Spectral") +
    facet_wrap(~sample) +
    guides(colour = guide_legend(
        override.aes = list(size =  5)))
print(g)
```

### Tinkerbell Map Territories
```{r view_chaos, eval = TRUE, echo = TRUE,fig.width = 9, fig.height=9, fig.cap = "Tinkerbell Map Territories"}
chaos <- do.call("rbind", chaos_map)
chaos$Territory <- as.factor(chaos$Territory)
g <- ggplot(chaos, aes(x = x, y = y, col = Territory)) +
    geom_point(size = 0.5) +
    theme_bw() +
    scale_color_brewer(palette = "Spectral") +
    facet_wrap(~sample) +
    guides(colour = guide_legend(
        override.aes = list(size =  5)))
print(g)
```

## Simulate New Cells

```{r counts, eval = TRUE, echo = TRUE}
circle_counts <- simulate_cells(circle,
    cell_composition = 2,
    n_genes = 2000,
    seed = 1729)

rod_counts <- simulate_cells(rod,
    cell_composition = 2,
    n_genes = 2000,
    seed = 1729)

chaos_counts <- simulate_cells(chaos_map,
    cell_composition = 2,
    n_genes = 2000,
    seed = 1729)
```

## Export Data sets
```{r export, eval = FALSE, echo = TRUE}
export_simulation(spatial = circle,
    cells = circle_counts,
    out_dir = output,
    file_tag = "circle_spatial_territories")
export_simulation(spatial = rod,
    cells = rod_counts,
    out_dir = output,
    file_tag = "circle_spatial_territories")
export_simulation(spatial = choas_map,
    cells = chaos_counts,
    out_dir = output,
    file_tag = "circle_spatial_territories")
```
